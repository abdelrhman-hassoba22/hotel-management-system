name: Build and Run Hotel Management

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y mysql-server libmysqlclient-dev g++

    - name: Start MySQL service
      run: |
        sudo systemctl start mysql
        sudo systemctl enable mysql

    - name: Create database and user
      run: |
        sudo mysql -e "CREATE DATABASE IF NOT EXISTS hoteldb;"
        sudo mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'mypwd';"
        sudo mysql -e "FLUSH PRIVILEGES;"

    - name: Debug - Show file contents
      run: |
        echo "=== File sizes ==="
        ls -la *.cpp
        echo "=== First 10 lines of each file ==="
        head -10 create-entities.cpp
        head -10 hotel-management.cpp

    - name: Try compiling create-entities.cpp
      run: |
        echo "=== Compiling create-entities.cpp ==="
        g++ create-entities.cpp -o create-entities -lmysqlclient -v 2>&1 || echo "Compilation failed, continuing..."

    - name: Try compiling hotel-management.cpp  
      run: |
        echo "=== Compiling hotel-management.cpp ==="
        g++ hotel-management.cpp -o hotel-management -lmysqlclient -v 2>&1 || echo "Compilation failed, continuing..."

    - name: Check if executables were created
      run: |
        echo "=== Checking for compiled executables ==="
        ls -la create-entities hotel-management 2>&1 || echo "Executables not found"

    - name: Try running create-entities
      run: |
        if [ -f "./create-entities" ]; then
          echo "=== Running create-entities ==="
          ./create-entities
        else
          echo "create-entities executable not found - skipping"
        fi

    - name: Try running hotel-management
      run: |
        if [ -f "./hotel-management" ]; then
          echo "=== Running hotel-management ==="
          ./hotel-management
        else
          echo "hotel-management executable not found - skipping"
        fi
